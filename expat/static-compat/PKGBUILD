# Contributor:  David Runge <dvzrv@archlinux.org>
# Contributor:  Bart≈Çomiej Piotrowski <bpiotrowski@archlinux.org>
# Contributor: Allan McRae <allan@archlinux.org>
# Contributor: Judd Vinet <jvinet@zeroflux.org>

_pkgname=expat
pkgname=static-compat-$_pkgname
pkgver=2.7.3
pkgrel=1
pkgdesc='An XML parser library'
arch=('x86_64')
url="https://libexpat.github.io/"
_url="https://github.com/libexpat/libexpat"
license=('MIT')
depends=('glibc-static-compat')
makedepends=('git' 'static-compat-cmake')
options=(staticlibs)
source=($_pkgname::git+$_url?signed#tag=R_${pkgver//./_})
sha512sums=('fe186f7ab59facee6b7af1ed03df89b3c778c8d2df9325bda7253a9eec20ba6530cf91910aea380b895dc7d5150a27e824242eca38685d9cffca00e0f4c61f80')
b2sums=('5c8dfd631233e19520a19248dbe90f5413d864317d1d72a8c65b5697bee56d83a497b43165c3aafa5e635fe72f7393572e3d2d7e892de72b95e445018cad8331')
validpgpkeys=(3176EF7DB2367F1FCA4F306B1F9B0E909AF37285) # Sebastian Pipping

build() {
  source static-compat-environment
  cd "$_pkgname/$_pkgname"
  static-compat-cmake \
    -DEXPAT_SHARED_LIBS=OFF \
    -DEXPAT_BUILD_TOOLS=OFF \
    -DEXPAT_BUILD_EXAMPLES=OFF \
    -W no-dev \
    -B build \
    -S .
  make VERBOSE=1 -C build
}

check() {
  source static-compat-environment
  cd "$_pkgname/$_pkgname"
  make VERBOSE=1 -C build test
}

package() {
  source static-compat-environment
  cd "$_pkgname/$_pkgname"
  make VERBOSE=1 DESTDIR="$pkgdir" -C build install
  rm -r "$pkgdir/$static_compat_prefix"/share
  install -vDm 644 COPYING -t "${pkgdir}/usr/share/licenses/$pkgname/"
}
